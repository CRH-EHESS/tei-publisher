<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/iron-form/iron-form.html">
<link rel="import" href="bower_components/iron-input/iron-input.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">

<dom-module id="pb-search">
    <template>
        <style>
            :host{
            }

            paper-input{
                --paper-input-container-input:{
                    color: var(--pb-search-input, --paper-black);
                    border: white;
                };
                --paper-input-container-label: {
                    color:var(--pb-search-label, --paper-grey-500);
                };
                padding-left:20px;
            }

        </style>
        <iron-form id="ironform" allow-redirect>
            <form id="searchPageForm" method="get" action="{{action}}">
                <paper-input id="search" type="search" name="query" on-keyup="_handleEnter" label="[[placeHolder]]" no-label-float value="[[value]]">
                    <iron-icon icon="search" on-click="_doSearch" slot="prefix"></iron-icon>
                </paper-input>

                <!--<input value="{{myValue::input}}" type="search" class="search-input" autocomplete="off" placeholder="[[placeHolder]]" name="query">-->
                <input type="hidden" name="doc" data-template="search:form-current-doc">
                <input type="hidden" name="field" value="text"/>
            </form>
        </iron-form>
    </template>
    <script>
        class PbSearch extends Polymer.Element {
            static get is() {
                return 'pb-search';
            }

            static get properties() {
                return {
                    action:{
                        type: String,
                        reflectToAttribute:true
                    },
                    value:{
                        type:String,
                        reflectToAttribute:true
                    },
                    placeHolder: {
                        type: String,
                        reflectToAttribute:true
                    },
                    currentDoc: {
                        type: String
                    }
                }
            }

            connectedCallback() {
                super.connectedCallback();
                console.log("action ", this.action);
            }

            _doSearch(e){
                console.log('_doSearch ',e);
                console.log('_doSearch serialize',this.$.ironform.serializeForm());
                this._doSubmit();
            }

            _handleEnter(e){
                if(this.$.search.value.length != 0 && e.keyCode == 13){
                    this._doSubmit();
                }
            }

            _doSubmit(){
                this.$.ironform.submit();
            }
        }

        window.customElements.define(PbSearch.is, PbSearch);
    </script>
</dom-module>
